####  Assigment 2   ####

####   Part One: Create a classify_gene function:   ####

classify_gene <- function(logFC, padj) {
  ifelse(padj < 0.05 & logFC > 1, "Upregulated",
         ifelse(padj < 0.05 & logFC < -1, "Downregulated", 
                "Not_Significant"))
 
}

#testing the function:
classify_gene(2.3, 0.01)

#### Preparing the environment: ####

dir.create("R/Assign_Raw_data")
dir.create("R/Assign2_Results")

input_dir <- "R/Assign_Raw_data"
output_dir <- "R/Assign2_Results"


files <- c("DEGs_Data_1.csv", "DEGs_Data_2.csv") 
result_list <- list()

#--------------------------------------------------------------------

#### Part Two: Apply the new function in a for-loop: ####

for (files_names in files) {
  cat("\nprocessing:", files_names, "\n")
  
  input_file_path <- file.path(input_dir, files_names)
  data <- read.csv(input_file_path, header = T)
  
  cat("File imported. Checking for missing values...\n")
  
  #count missing values for logFC replace them with the mean:
  if("logFC" %in% names(data)) {
    missing_count <- sum(is.na(data$logFC))
    
    cat("Missing values in logFC:", missing_count, "\n")
    data$logFC[is.na(data$logFC)] <- mean(data$logFC, na.rm = T)
    }
  
  #count missing values for padj and replace them with the 1:
  if("padj" %in% names(data)) {
    missing_count <- sum(is.na(data$padj))
    
    cat("Missing values in padj:", missing_count, "\n")
    data$padj[is.na(data$padj)] <- 1
    }
  
  #Apply the function:
  data$status <- classify_gene(data$logFC, data$padj)
  
  cat("Statues have been determined successfully.\n")
  
  result_list[[files_names]] <- data
  output_file_path <- file.path(output_dir,paste0("Processed_", files_names))
  write.csv(x = data, file = output_file_path, row.names = FALSE)
  
  cat("Results saved to:", output_file_path, "\n")
  
  print(table(data$status))
  cat("Total Significant genes:", sum(data$status != "Not_Significant"), "\n")
}

results_1 <- result_list[[1]] 
results_2 <- result_list[[2]]
